{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/OpenMindS-IT-Lab/todo-expander/main/schema/todoexpand.schema.json",
  "title": "TODO Expander Configuration",
  "description": "Configuration schema for .todoexpandrc.json files used by todo-expander",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for IDE support",
      "format": "uri"
    },
    "include": {
      "type": "array",
      "description": "File extensions to include (lowercase, without leading dot)",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9]+$",
        "description": "File extension without dot (e.g., 'ts', 'js', 'py')"
      },
      "default": ["ts", "tsx", "js", "jsx"],
      "examples": [
        ["ts", "tsx", "js", "jsx"],
        ["ts", "js", "py", "go", "rs"],
        ["md", "txt"]
      ]
    },
    "exclude": {
      "type": "array",
      "description": "Directory segments to exclude (matches if path contains `/<seg>/`)",
      "items": {
        "type": "string",
        "description": "Directory name or path segment to exclude"
      },
      "default": ["node_modules", "build", "dist", ".git"],
      "examples": [
        ["node_modules", "build", "dist", ".git"],
        ["node_modules", "target", "__pycache__", "venv", ".venv"]
      ]
    },
    "style": {
      "type": "string",
      "description": "Preferred brief verbosity style",
      "enum": ["succinct", "verbose"],
      "default": "succinct",
      "examples": ["succinct", "verbose"]
    },
    "sections": {
      "type": "array",
      "description": "Ordered section names for the structured brief",
      "items": {
        "type": "string",
        "minLength": 1,
        "description": "Section name (e.g., 'Context', 'Goal', 'Steps')"
      },
      "minItems": 1,
      "default": ["Context", "Goal", "Steps", "Constraints", "Acceptance"],
      "examples": [
        ["Context", "Goal", "Steps", "Constraints", "Acceptance"],
        ["Context", "Objective", "Implementation", "Testing"],
        ["Overview", "Tasks", "Validation"]
      ]
    },
    "model": {
      "type": "string",
      "description": "OpenAI model ID for the Chat Completions API",
      "default": "gpt-4o-mini",
      "examples": ["gpt-4o-mini", "gpt-4o", "gpt-4", "gpt-3.5-turbo"]
    },
    "endpoint": {
      "type": "string",
      "description": "OpenAI API endpoint URL",
      "format": "uri",
      "default": "https://api.openai.com/v1/chat/completions",
      "examples": [
        "https://api.openai.com/v1/chat/completions",
        "https://your-proxy.com/v1/chat/completions"
      ]
    },
    "timeout": {
      "type": "integer",
      "description": "Network timeout (ms) for API requests",
      "minimum": 1000,
      "maximum": 300000,
      "default": 45000,
      "examples": [30000, 45000, 60000, 120000]
    },
    "concurrency": {
      "type": "integer",
      "description": "Maximum concurrent LLM requests when processing multiple TODOs",
      "minimum": 1,
      "maximum": 10,
      "default": 1,
      "examples": [1, 3, 5]
    },
    "contextLines": {
      "type": "integer",
      "description": "Number of context lines to include above/below a TODO",
      "minimum": 0,
      "maximum": 50,
      "default": 12,
      "examples": [5, 10, 12, 15, 20]
    },
    "cache": {
      "type": "boolean",
      "description": "Enable on-disk response cache keyed by file + TODO content",
      "default": true
    },
    "format": {
      "type": "boolean",
      "description": "After rewrite, run a formatter pass (Prettier/deno fmt)",
      "default": true
    },
    "strict": {
      "type": "boolean",
      "description": "Reserved for stricter validations in future iterations",
      "default": false
    },
    "print": {
      "type": "boolean",
      "description": "Print rewritten comments (useful for dry-run output)",
      "default": false
    },
    "maxFileKB": {
      "type": "integer",
      "description": "Maximum file size to process (kilobytes)",
      "minimum": 1,
      "maximum": 10240,
      "default": 512,
      "examples": [256, 512, 1024, 2048]
    },
    "verboseLogs": {
      "type": "boolean",
      "description": "Verbose logging for per-file and per-TODO progress",
      "default": false
    },
    "retries": {
      "type": "integer",
      "description": "Number of retry attempts for LLM requests (excluding the first try)",
      "minimum": 0,
      "maximum": 5,
      "default": 2,
      "examples": [0, 1, 2, 3]
    },
    "retryBackoffMs": {
      "type": "integer",
      "description": "Base backoff in ms for retry delays (exponential with jitter)",
      "minimum": 100,
      "maximum": 5000,
      "default": 500,
      "examples": [250, 500, 1000, 2000]
    },
    "perFileTimeoutMs": {
      "type": "integer",
      "description": "Per-file timeout; abort processing a file after this many ms",
      "minimum": 10000,
      "maximum": 600000,
      "default": 120000,
      "examples": [60000, 120000, 300000]
    }
  },
  "examples": [
    {
      "$schema": "https://raw.githubusercontent.com/OpenMindS-IT-Lab/todo-expander/main/schema/todoexpand.schema.json",
      "style": "succinct",
      "include": ["ts", "tsx", "js", "jsx"],
      "exclude": ["node_modules", "build", "dist", ".git"],
      "sections": ["Context", "Goal", "Steps", "Constraints", "Acceptance"],
      "contextLines": 12,
      "timeout": 45000,
      "concurrency": 1,
      "cache": true,
      "format": true
    },
    {
      "$schema": "https://raw.githubusercontent.com/OpenMindS-IT-Lab/todo-expander/main/schema/todoexpand.schema.json",
      "style": "verbose",
      "include": ["ts", "tsx", "js", "jsx", "py", "go", "rs", "java"],
      "exclude": [
        "node_modules",
        "build",
        "dist",
        ".git",
        "target",
        "__pycache__",
        "venv",
        ".venv"
      ],
      "sections": [
        "Context",
        "Goal",
        "Steps",
        "Dependencies",
        "Testing",
        "Acceptance"
      ],
      "contextLines": 15,
      "timeout": 60000,
      "concurrency": 3,
      "cache": true,
      "format": true,
      "verboseLogs": true
    },
    {
      "$schema": "https://raw.githubusercontent.com/OpenMindS-IT-Lab/todo-expander/main/schema/todoexpand.schema.json",
      "style": "succinct",
      "include": ["ts", "tsx", "js", "jsx", "md"],
      "exclude": ["node_modules", "build", "dist"],
      "sections": ["Context", "Goal", "Steps", "Acceptance"],
      "contextLines": 10,
      "timeout": 30000,
      "concurrency": 1,
      "cache": false,
      "format": true
    }
  ]
}
